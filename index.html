<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>RENT. â€“ Suivi abonnements</title>
<meta name="theme-color" content="#0b0d10" />
<link rel="manifest" href="manifest.webmanifest?v=9">
<link rel="apple-touch-icon" href="icons/icon-180.png" />
<style>
:root {
  --bg:#0b0d10; --bg-2:#0f1217; --glass:rgba(255,255,255,0.06);
  --text:#e8ecf1; --muted:#9aa6b2; --accent:#ff3ea5; --accent-2:#6c5ce7;
  --shadow:0 10px 30px rgba(0,0,0,.45); --radius-xl:22px; --blur:20px;
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:ui-rounded,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  color:var(--text);
  background:
    radial-gradient(1200px 800px at 90% -10%, rgba(255,62,165,.15), transparent 60%),
    radial-gradient(1000px 700px at -10% 110%, rgba(108,92,231,.15), transparent 60%),
    linear-gradient(180deg, var(--bg), var(--bg-2));
  background-attachment:fixed;
}
.app{max-width:860px;margin-inline:auto;padding:clamp(16px,3.5vw,28px);display:flex;flex-direction:column;gap:16px}
header{display:grid;gap:14px}
.titlebar{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.logo-text{font-size:28px;font-weight:900;letter-spacing:.5px}
.logo-text span{color:var(--accent);font-size:32px}
.top-buttons{display:flex;gap:8px}
.top-buttons button{padding:8px 14px;border-radius:12px;border:0;background:var(--glass);color:var(--text);font-size:14px}
.cards{display:grid;grid-template-columns:1fr;gap:12px}
@media(min-width:680px){.cards{grid-template-columns:repeat(2,1fr)}}
.glass{background:var(--glass);backdrop-filter:blur(var(--blur));border-radius:var(--radius-xl);box-shadow:var(--shadow), inset 0 0 0 1px rgba(255,255,255,.07)}
.kpi{padding:16px;display:flex;flex-direction:column;gap:10px}
.kpi h2{font-size:13px;color:var(--muted);font-weight:600}
.fab{position:fixed;right:18px;bottom:calc(18px + var(--safe-bottom));z-index:50;padding:14px 18px;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent-2));border:0;color:white;border-radius:20px;box-shadow:var(--shadow);transition:.2s ease;}
.fab.hidden{opacity:0;pointer-events:none;transform:translateY(8px)}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);display:none;align-items:flex-end;z-index:60}
.overlay.open{display:flex}
.sheet{width:100%;background:var(--glass);backdrop-filter:blur(var(--blur));border-radius:22px 22px 0 0;box-shadow:var(--shadow);display:flex;flex-direction:column;max-height:85vh}
.form-body{padding:16px;overflow:auto}
.fields{display:grid;gap:12px}
label{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted)}
input,select{background:rgba(255,255,255,.08);color:var(--text);border:0;border-radius:12px;padding:14px;font-size:16px}
.action-bar{padding:12px;display:flex;gap:8px;background:rgba(0,0,0,.25)}
.action-bar .btn{flex:1;padding:12px;font-weight:800}
.btn{cursor:pointer;border:0;border-radius:12px;background:var(--glass);color:var(--text)}
.btn.primary{background:linear-gradient(135deg,rgba(255,62,165,.4),rgba(108,92,231,.35))}
.item{padding:14px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,.07),rgba(255,255,255,.03));box-shadow:inset 0 0 0 1px rgba(255,255,255,.06);margin-bottom:8px;display:flex;align-items:center;gap:10px;justify-content:space-between}
.item-info{flex:1;min-width:0}
.item-title{font-weight:700;font-size:16px;line-height:1.2;word-break:break-word;white-space:normal;overflow-wrap:break-word}
.item-sub{font-size:12px;color:var(--muted)}
.item-actions{display:flex;gap:6px;flex-shrink:0}
.item-actions button{background:none;border:none;cursor:pointer;font-size:18px;color:var(--text)}
@media(max-width:480px){
  .item-title{font-size:14px}
  .item-sub{font-size:11px}
}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="titlebar">
      <div class="logo-text">RENT<span>.</span></div>
      <div class="top-buttons">
        <button id="export-btn">Exporter</button>
        <button id="import-btn">Importer</button>
        <input type="file" id="import-file" style="display:none" />
      </div>
    </div>
    <div class="cards">
      <div class="glass kpi"><h2>Total mensuel</h2><div id="total-month">0â‚¬</div></div>
      <div class="glass kpi"><h2>Total annuel</h2><div id="total-year">0â‚¬</div></div>
    </div>
  </header>
  <main>
    <h3>Abonnements mensuels</h3>
    <div id="list-month"></div>
    <h3>Abonnements annuels</h3>
    <div id="list-year"></div>
  </main>
</div>

<button class="fab" id="btn-add">+ Ajouter</button>

<div class="overlay" id="overlay">
  <form class="sheet" id="form">
    <div class="form-body">
      <div class="fields">
        <label>Nom<input id="name" required></label>
        <label>Montant<input id="amount" type="number" step="0.01" required></label>
        <label>PÃ©riodicitÃ©<select id="period"><option value="month">Mensuel</option><option value="year">Annuel</option></select></label>
      </div>
    </div>
    <div class="action-bar">
      <button type="button" class="btn" id="btn-cancel">Annuler</button>
      <button type="submit" class="btn primary">Enregistrer</button>
    </div>
  </form>
</div>

<script>
const fab=document.getElementById('btn-add');
const overlay=document.getElementById('overlay');
const form=document.getElementById('form');
const listMonth=document.getElementById('list-month');
const listYear=document.getElementById('list-year');
const totalMonth=document.getElementById('total-month');
const totalYear=document.getElementById('total-year');
const exportBtn=document.getElementById('export-btn');
const importBtn=document.getElementById('import-btn');
const importFile=document.getElementById('import-file');
let subs=JSON.parse(localStorage.getItem('subs')||'[]');
let editIndex=null;

function saveData(){
  localStorage.setItem('subs',JSON.stringify(subs));
}

function render(){
  listMonth.innerHTML='';
  listYear.innerHTML='';
  const monthSubs=subs.filter(s=>s.period==='month');
  const yearSubs=subs.filter(s=>s.period==='year');
  monthSubs.forEach((s,i)=>listMonth.appendChild(createItem(s,i)));
  yearSubs.forEach((s,i)=>listYear.appendChild(createItem(s,i)));
  const totalM=monthSubs.reduce((a,b)=>a+b.amount,0)+yearSubs.reduce((a,b)=>a+b.amount/12,0);
  const totalY=yearSubs.reduce((a,b)=>a+b.amount,0)+monthSubs.reduce((a,b)=>a+b.amount*12,0);
  totalMonth.textContent=`${totalM.toFixed(2)}â‚¬`;
  totalYear.textContent=`${totalY.toFixed(2)}â‚¬`;
}

function createItem(sub,index){
  const div=document.createElement('div');
  div.className='item';
  const info=document.createElement('div');
  info.className='item-info';
  info.innerHTML=`<div class="item-title">${sub.name}</div>
                  <div class="item-sub">${sub.amount}â‚¬ / ${sub.period==='month'?'mois':'an'}</div>`;
  const actions=document.createElement('div');
  actions.className='item-actions';
  const editBtn=document.createElement('button');
  editBtn.innerHTML='âœï¸';
  editBtn.onclick=()=>editSub(index,sub.period);
  const delBtn=document.createElement('button');
  delBtn.innerHTML='ðŸ—‘ï¸';
  delBtn.onclick=()=>{subs.splice(subs.indexOf(sub),1);saveData();render();};
  actions.appendChild(editBtn);
  actions.appendChild(delBtn);
  div.appendChild(info);
  div.appendChild(actions);
  return div;
}

function editSub(index,period){
  const sub=subs.filter(s=>s.period===period)[index];
  document.getElementById('name').value=sub.name;
  document.getElementById('amount').value=sub.amount;
  document.getElementById('period').value=sub.period;
  editIndex=subs.indexOf(sub);
  overlay.classList.add('open');
  fab.classList.add('hidden');
}

fab.onclick=()=>{form.reset();editIndex=null;overlay.classList.add('open');fab.classList.add('hidden');};
document.getElementById('btn-cancel').onclick=()=>{overlay.classList.remove('open');fab.classList.remove('hidden');};

form.onsubmit=e=>{
  e.preventDefault();
  const name=document.getElementById('name').value;
  const amount=parseFloat(document.getElementById('amount').value);
  const period=document.getElementById('period').value;
  if(editIndex!==null){
    subs[editIndex]={name,amount,period};
  }else{
    subs.push({name,amount,period});
  }
  saveData();
  overlay.classList.remove('open');
  fab.classList.remove('hidden');
  render();
};

exportBtn.onclick=()=>{
  const blob=new Blob([JSON.stringify(subs)],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download='abonnements.json';a.click();
};

importBtn.onclick=()=>importFile.click();
importFile.onchange=e=>{
  const file=e.target.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=evt=>{
    try{
      const data=JSON.parse(evt.target.result);
      if(Array.isArray(data)){subs=data;saveData();render();}
    }catch(err){alert('Fichier invalide');}
  };
  reader.readAsText(file);
};

render();
</script>
</body>
</html>
